<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>Apri Porta - NEASPACE</title>
  <script>
    async function init() {
      const bookingId = new URLSearchParams(window.location.search).get('b');
      const msgBox = document.getElementById("message");

      if (!bookingId) {
        msgBox.innerHTML = "<h2>‚ùå Booking ID mancante</h2>";
        return;
      }

      msgBox.innerHTML = "<h2>‚è≥ Controllo prenotazione...</h2>";

      try {
        // chiamata al tuo server su Render
        const res = await fetch(`https://one9rueneuve.onrender.com/booking/${bookingId}`);
        if (!res.ok) throw new Error("Errore dal server");

        const data = await res.json();
        const today = new Date();
        today.setHours(0,0,0,0);

        const start = new Date(data.start);
        const end = new Date(data.end);
        start.setHours(0,0,0,0);
        end.setHours(0,0,0,0);

        if (today >= start && today <= end) {
          // dentro le date ‚Üí apri porta (manda ping su Telegram)
          msgBox.innerHTML = `<h2>üåû La porta √® aperta! Sali al secondo piano, porta destra, codice 0204.<br>Mandaci un messaggino per confermare che siete a casa!</h2>`;
          await fetch(`https://one9rueneuve.onrender.com/open/${bookingId}`);
        } else {
          // fuori dalle date
          msgBox.innerHTML = `<h2>üö´ La porta si apre solo tra ${start.toLocaleDateString()} e ${end.toLocaleDateString()}.</h2>`;
        }
      } catch (err) {
        console.error(err);
        msgBox.innerHTML = "<h2>‚ö†Ô∏è Errore nel caricamento dati</h2>";
      }
    }

    window.onload = init;
  </script>
  <style>
    body {
      background-color: #EAF6FF;
      color: #1a1a1a;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 0;
      text-align: center;
      font-size: 28px;
    }
    .header {
      background: white;
      padding: 20px 10px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .header img {
      max-height: 80px;
      margin-right: 20px;
    }
    .header span {
      font-size: 48px;
      font-weight: bold;
      color: #111;
    }
    .content {
      padding: 80px 25px;
    }
    h2 {
      font-size: 42px;
      margin: 30px;
      line-height: 1.6;
    }
  </style>
</head>
<body>
  <div class="header">
    <img src="https://login.smoobu.com/upload/images/website/logo/6/4/6/6/e/2/a/6/website_logo_530938_abf503416885c3141843d801c3717c2063e4bda6b56bf5268b3e1b264a7d8eae.jpg" alt="Logo NeaSpace">
    <span>NeaSpace</span>
  </div>
  <div class="content" id="message">
    <h2>‚è≥ Controllo prenotazione in corso...</h2>
  </div>
</body>
</html>
